{
  "type": "Program",
  "line": null,
  "column": null,
  "spec_version": "1.0",
  "app_theme": "light",
  "app_theme_line": null,
  "app_theme_column": null,
  "theme_tokens": {},
  "theme_preference": {
    "allow_override": [
      false,
      null,
      null
    ],
    "persist": [
      "none",
      null,
      null
    ]
  },
  "ui_settings": {
    "accent_color": [
      "blue",
      null,
      null
    ],
    "density": [
      "comfortable",
      null,
      null
    ],
    "motion": [
      "subtle",
      null,
      null
    ],
    "shape": [
      "rounded",
      null,
      null
    ],
    "surface": [
      "flat",
      null,
      null
    ],
    "theme": [
      "light",
      null,
      null
    ]
  },
  "ui_line": null,
  "ui_column": null,
  "capabilities": [],
  "records": [],
  "functions": [
    {
      "type": "FunctionDecl",
      "line": 3,
      "column": 1,
      "name": "apply tax",
      "signature": {
        "type": "FunctionSignature",
        "line": 3,
        "column": 1,
        "inputs": [
          {
            "type": "FunctionParam",
            "line": 5,
            "column": 5,
            "name": "subtotal",
            "type_name": "number",
            "required": true
          }
        ],
        "outputs": [
          {
            "type": "FunctionParam",
            "line": 7,
            "column": 5,
            "name": "total",
            "type_name": "number",
            "required": true
          },
          {
            "type": "FunctionParam",
            "line": 8,
            "column": 5,
            "name": "note",
            "type_name": "text",
            "required": false
          }
        ]
      },
      "body": [
        {
          "type": "Return",
          "line": 9,
          "column": 3,
          "expression": {
            "type": "MapExpr",
            "line": 9,
            "column": 10,
            "entries": [
              {
                "type": "MapEntry",
                "line": 10,
                "column": 5,
                "key": {
                  "type": "Literal",
                  "line": 10,
                  "column": 5,
                  "value": "total"
                },
                "value": {
                  "type": "BinaryOp",
                  "line": 10,
                  "column": 25,
                  "op": "+",
                  "left": {
                    "type": "VarReference",
                    "line": 10,
                    "column": 16,
                    "name": "subtotal"
                  },
                  "right": {
                    "type": "Literal",
                    "line": 10,
                    "column": 27,
                    "value": "1"
                  }
                }
              }
            ]
          }
        }
      ]
    }
  ],
  "flows": [
    {
      "type": "Flow",
      "line": 12,
      "column": 1,
      "name": "core_demo",
      "body": [
        {
          "type": "Let",
          "line": 13,
          "column": 3,
          "name": "base",
          "expression": {
            "type": "BinaryOp",
            "line": 13,
            "column": 17,
            "op": "+",
            "left": {
              "type": "Literal",
              "line": 13,
              "column": 15,
              "value": "2"
            },
            "right": {
              "type": "BinaryOp",
              "line": 13,
              "column": 21,
              "op": "*",
              "left": {
                "type": "Literal",
                "line": 13,
                "column": 19,
                "value": "3"
              },
              "right": {
                "type": "Literal",
                "line": 13,
                "column": 23,
                "value": "4"
              }
            }
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 14,
          "column": 3,
          "name": "remainder",
          "expression": {
            "type": "BinaryOp",
            "line": 14,
            "column": 23,
            "op": "%",
            "left": {
              "type": "Literal",
              "line": 14,
              "column": 20,
              "value": "10"
            },
            "right": {
              "type": "Literal",
              "line": 14,
              "column": 25,
              "value": "4"
            }
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 15,
          "column": 3,
          "name": "adjusted",
          "expression": {
            "type": "BinaryOp",
            "line": 15,
            "column": 24,
            "op": "+",
            "left": {
              "type": "VarReference",
              "line": 15,
              "column": 19,
              "name": "base"
            },
            "right": {
              "type": "VarReference",
              "line": 15,
              "column": 26,
              "name": "remainder"
            }
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 16,
          "column": 3,
          "name": "summary",
          "expression": {
            "type": "CallFunctionExpr",
            "line": 16,
            "column": 18,
            "function_name": "apply tax",
            "arguments": [
              {
                "type": "FunctionCallArg",
                "line": 17,
                "column": 5,
                "name": "subtotal",
                "value": {
                  "type": "VarReference",
                  "line": 17,
                  "column": 17,
                  "name": "adjusted"
                }
              }
            ]
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 18,
          "column": 3,
          "name": "numbers",
          "expression": {
            "type": "ListExpr",
            "line": 18,
            "column": 18,
            "items": [
              {
                "type": "Literal",
                "line": 19,
                "column": 5,
                "value": "1"
              },
              {
                "type": "Literal",
                "line": 20,
                "column": 5,
                "value": "2"
              }
            ]
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 21,
          "column": 3,
          "name": "numbers2",
          "expression": {
            "type": "ListOpExpr",
            "line": 21,
            "column": 19,
            "kind": "append",
            "target": {
              "type": "VarReference",
              "line": 21,
              "column": 31,
              "name": "numbers"
            },
            "value": {
              "type": "Literal",
              "line": 21,
              "column": 44,
              "value": "3"
            },
            "index": null
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 22,
          "column": 3,
          "name": "count",
          "expression": {
            "type": "ListOpExpr",
            "line": 22,
            "column": 16,
            "kind": "length",
            "target": {
              "type": "VarReference",
              "line": 22,
              "column": 31,
              "name": "numbers2"
            },
            "value": null,
            "index": null
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 23,
          "column": 3,
          "name": "data",
          "expression": {
            "type": "MapExpr",
            "line": 23,
            "column": 15,
            "entries": [
              {
                "type": "MapEntry",
                "line": 24,
                "column": 5,
                "key": {
                  "type": "Literal",
                  "line": 24,
                  "column": 5,
                  "value": "count"
                },
                "value": {
                  "type": "VarReference",
                  "line": 24,
                  "column": 16,
                  "name": "count"
                }
              },
              {
                "type": "MapEntry",
                "line": 25,
                "column": 5,
                "key": {
                  "type": "Literal",
                  "line": 25,
                  "column": 5,
                  "value": "label"
                },
                "value": {
                  "type": "Literal",
                  "line": 25,
                  "column": 16,
                  "value": "ok"
                }
              }
            ]
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 26,
          "column": 3,
          "name": "data2",
          "expression": {
            "type": "MapOpExpr",
            "line": 26,
            "column": 16,
            "kind": "set",
            "target": {
              "type": "VarReference",
              "line": 26,
              "column": 24,
              "name": "data"
            },
            "key": {
              "type": "Literal",
              "line": 26,
              "column": 33,
              "value": "extra"
            },
            "value": {
              "type": "Literal",
              "line": 26,
              "column": 47,
              "value": "yes"
            }
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 27,
          "column": 3,
          "name": "keys",
          "expression": {
            "type": "MapOpExpr",
            "line": 27,
            "column": 15,
            "kind": "keys",
            "target": {
              "type": "VarReference",
              "line": 27,
              "column": 24,
              "name": "data2"
            },
            "key": null,
            "value": null
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 28,
          "column": 3,
          "name": "first_key",
          "expression": {
            "type": "ListOpExpr",
            "line": 28,
            "column": 20,
            "kind": "get",
            "target": {
              "type": "VarReference",
              "line": 28,
              "column": 29,
              "name": "keys"
            },
            "value": null,
            "index": {
              "type": "Literal",
              "line": 28,
              "column": 37,
              "value": "0"
            }
          },
          "constant": false
        },
        {
          "type": "Let",
          "line": 29,
          "column": 3,
          "name": "i",
          "expression": {
            "type": "Literal",
            "line": 29,
            "column": 12,
            "value": "0"
          },
          "constant": false
        },
        {
          "type": "RepeatWhile",
          "line": 30,
          "column": 3,
          "condition": {
            "type": "Comparison",
            "line": 30,
            "column": 18,
            "kind": "lt",
            "left": {
              "type": "VarReference",
              "line": 30,
              "column": 16,
              "name": "i"
            },
            "right": {
              "type": "Literal",
              "line": 30,
              "column": 31,
              "value": "2"
            }
          },
          "limit": 3,
          "body": [
            {
              "type": "Set",
              "line": 31,
              "column": 5,
              "target": {
                "type": "VarReference",
                "line": 31,
                "column": 9,
                "name": "i"
              },
              "expression": {
                "type": "BinaryOp",
                "line": 31,
                "column": 16,
                "op": "+",
                "left": {
                  "type": "VarReference",
                  "line": 31,
                  "column": 14,
                  "name": "i"
                },
                "right": {
                  "type": "Literal",
                  "line": 31,
                  "column": 18,
                  "value": "1"
                }
              }
            }
          ],
          "limit_line": 30,
          "limit_column": 39
        },
        {
          "type": "If",
          "line": 32,
          "column": 3,
          "condition": {
            "type": "BinaryOp",
            "line": 32,
            "column": 34,
            "op": "and",
            "left": {
              "type": "Comparison",
              "line": 32,
              "column": 15,
              "kind": "gt",
              "left": {
                "type": "VarReference",
                "line": 32,
                "column": 6,
                "name": "adjusted"
              },
              "right": {
                "type": "Literal",
                "line": 32,
                "column": 31,
                "value": "10"
              }
            },
            "right": {
              "type": "Comparison",
              "line": 32,
              "column": 48,
              "kind": "eq",
              "left": {
                "type": "VarReference",
                "line": 32,
                "column": 38,
                "name": "first_key"
              },
              "right": {
                "type": "Literal",
                "line": 32,
                "column": 60,
                "value": "count"
              }
            }
          },
          "then_body": [
            {
              "type": "Return",
              "line": 33,
              "column": 5,
              "expression": {
                "type": "MapOpExpr",
                "line": 33,
                "column": 12,
                "kind": "get",
                "target": {
                  "type": "VarReference",
                  "line": 33,
                  "column": 20,
                  "name": "data"
                },
                "key": {
                  "type": "Literal",
                  "line": 33,
                  "column": 29,
                  "value": "count"
                },
                "value": null
              }
            }
          ],
          "else_body": []
        },
        {
          "type": "Return",
          "line": 34,
          "column": 3,
          "expression": {
            "type": "MapOpExpr",
            "line": 34,
            "column": 10,
            "kind": "get",
            "target": {
              "type": "VarReference",
              "line": 34,
              "column": 18,
              "name": "summary"
            },
            "key": {
              "type": "Literal",
              "line": 34,
              "column": 30,
              "value": "total"
            },
            "value": null
          }
        }
      ],
      "requires": null,
      "audited": false
    }
  ],
  "jobs": [],
  "pages": [],
  "ais": [],
  "tools": [],
  "agents": [],
  "ui_packs": [],
  "uses": [],
  "capsule": null,
  "agent_team": null,
  "identity": null
}

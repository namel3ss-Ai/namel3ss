from __future__ import annotations

from namel3ss.lang.keywords import KEYWORD_LIST
from namel3ss.lang.types import CANONICAL_TYPES, LEGACY_TYPE_ALIASES, canonicalize_type_name


def test_keyword_list_is_stable() -> None:
    expected = [
        "flow",
        "page",
        "app",
        "spec",
        "ai",
        "ask",
        "with",
        "input",
        "input_schema",
        "output_schema",
        "as",
        "provider",
        "tools",
        "expose",
        "tool",
        "call",
        "kind",
        "entry",
        "purity",
        "timeout_seconds",
        "memory",
        "short_term",
        "semantic",
        "profile",
        "agent",
        "agents",
        "parallel",
        "async",
        "run",
        "model",
        "translate",
        "qa",
        "cot",
        "chain",
        "system_prompt",
        "title",
        "text",
        "theme",
        "theme_tokens",
        "theme_preference",
        "ui",
        "form",
        "table",
        "button",
        "section",
        "card",
        "row",
        "column",
        "divider",
        "image",
        "calls",
        "record",
        "save",
        "create",
        "find",
        "where",
        "let",
        "latest",
        "set",
        "require",
        "return",
        "await",
        "yield",
        "repeat",
        "up",
        "to",
        "times",
        "for",
        "each",
        "in",
        "match",
        "when",
        "otherwise",
        "try",
        "catch",
        "if",
        "else",
        "is",
        "greater",
        "less",
        "equal",
        "than",
        "and",
        "or",
        "not",
        "state",
        "constant",
        "true",
        "false",
        "null",
        "string",
        "str",
        "int",
        "integer",
        "number",
        "boolean",
        "bool",
        "json",
        "must",
        "be",
        "present",
        "unique",
        "pattern",
        "param",
        "have",
        "length",
        "at",
        "least",
        "most",
        "capabilities",
        "job",
        "enqueue",
    ]
    assert KEYWORD_LIST == expected


def test_types_are_canonical() -> None:
    assert CANONICAL_TYPES == {"text", "number", "boolean", "json", "list", "map"}
    assert LEGACY_TYPE_ALIASES == {
        "string": "text",
        "str": "text",
        "int": "number",
        "integer": "number",
        "bool": "boolean",
    }
    assert canonicalize_type_name("text") == ("text", False)
    assert canonicalize_type_name("json") == ("json", False)
    assert canonicalize_type_name("list") == ("list", False)
    assert canonicalize_type_name("map") == ("map", False)
    assert canonicalize_type_name("string") == ("text", True)
    assert canonicalize_type_name("int") == ("number", True)
    assert canonicalize_type_name("bool") == ("boolean", True)
    assert canonicalize_type_name("custom") == ("custom", False)

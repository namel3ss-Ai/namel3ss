spec is "1.0"

tool "fetch_weather":
  implemented using python

  input:
    city is text

  output:
    days is json
    source is text
    note is text
    last_updated is text
    stale is boolean

record "WeatherRequest":
  field "city" is text must be present

record "WeatherDay":
  field "date" is text must be present
  field "condition" is text must be present
  field "temperature" is number must be present

record "WeatherStatus":
  field "source" is text must be present
  field "note" is text
  field "last_updated" is text must be present
  field "stale" is boolean must be present

record "Status":
  field "message" is text must be present

flow "seed_city":
  set state.weather.city is "Brussels"
  set state.error is null
  set state.status.message is "No errors ✅"
  delete "Status" where true
  create "Status" with state.status as status
  return "seeded"

flow "reset_state":
  set state.weather.city is null
  set state.error is null
  set state.status.message is "No errors ✅"
  delete "Status" where true
  create "Status" with state.status as status
  return "reset"

flow "get_forecast":
  let result is fetch_weather:
    city is input.values.city
  delete "WeatherDay" where true
  delete "WeatherStatus" where true
  for each day in result.days:
    set state.weather_day.date is day.date
    set state.weather_day.condition is day.condition
    set state.weather_day.temperature is day.temperature
    create "WeatherDay" with state.weather_day as weather_day
  set state.weather_status.source is result.source
  set state.weather_status.note is result.note
  set state.weather_status.last_updated is result.last_updated
  set state.weather_status.stale is result.stale
  create "WeatherStatus" with state.weather_status as weather_status
  set state.error is null
  set state.status.message is "No errors ✅"
  delete "Status" where true
  create "Status" with state.status as status
  return "ok"

page "home":
  title is "Weather Dashboard"
  section "Quick actions":
    row:
      column:
        button "Seed City":
          calls flow "seed_city"
      column:
        button "Reset":
          calls flow "reset_state"
      column:
        button "Get Forecast":
          calls flow "get_forecast"
  section "City":
    card "Search":
      form is "WeatherRequest"
      button "Get forecast":
        calls flow "get_forecast"
  section "Forecast":
    card "Forecast":
      table is "WeatherDay"
  card "Data source":
    table is "WeatherStatus"
  card "Status":
    table is "Status"
